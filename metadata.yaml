# Copyright 2023 Canonical Ltd.
# See LICENSE file for licensing details.
#

name: resource-dispatcher
description: |
  Resource Dispatcher charm for injecting Kubernetes resources to desired namespaces.
summary: |
  Charm responsible for injecting kubernetes object to newly created namespaces.
charm-user: non-root
containers:
  resource-dispatcher:
    resource: oci-image
    uid: 584792
    gid: 584792
resources:
  oci-image:
    type: oci-image
    description: Backing OCI image
    upstream-source: docker.io/charmedkubeflow/resource-dispatcher:3.1-19fc3ab
provides:
  provide-cmr-mesh:
    interface: cross_model_mesh
    description: |
      Access a cross-model application from catalogue via the service mesh.
      This relation provides additional data required by the service mesh to enforce
      cross-model authorization policies.
      If this app is generating policies to provide access to related applications that
      are cross-model, relate that app to this additional relation to retrieve additional
      data required for these policies. This is required because Juju does not natively
      provide all information required to build these policies when related cross-model.
  secrets:
    interface: kubernetes_manifest
  service-accounts:
    interface: kubernetes_manifest
  pod-defaults:
    interface: kubernetes_manifest
  roles:
    interface: kubernetes_manifest
  role-bindings:
    interface: kubernetes_manifest
requires:
  require-cmr-mesh:
    interface: cross_model_mesh
    description: |
      Allow a cross-model application access to catalogue via the service mesh.
      This relation provides additional data required by the service mesh to enforce
      cross-model authorization policies.
      If this app relates to other applications on a charmed service mesh cross-model,
      use this relation to send that related app additional data needed to automatically
      generate traffic authorization policies. This is required because Juju does not
      natively provide all information required to build these policies when related
      cross-model.
  service-mesh:
    limit: 1
    interface: service_mesh
    description: |
      Subscribe this charm into a service mesh to enforce authorization policies.
